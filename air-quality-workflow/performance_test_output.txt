================================================================================
Azure Functions Serverless Workflow - 性能测试
================================================================================

开始时间: 2025-11-19 01:24:12

测试配置：
  - 平台: Azure Functions (Python)
  - 数据库: Azure SQL Database
  - 触发机制: Timer Trigger + Change Tracking

================================================================================
测试场景: BATCH_SIZE=20, STATION_COUNT=5
================================================================================
  数据库已清空

  测试 1: BATCH_SIZE=20, STATION_COUNT=5
    - 测试 GenerateAirQualityData... ✓ (9.039s)
    - 测试 ProcessAirQualitySummary... ✓ (4.559s)
    - 总耗时: 13.598s
    - 吞吐量: 2.21 记录/秒
  数据库已清空

  测试 2: BATCH_SIZE=20, STATION_COUNT=5
    - 测试 GenerateAirQualityData... ✓ (8.312s)
    - 测试 ProcessAirQualitySummary... ✓ (4.026s)
    - 总耗时: 12.338s
    - 吞吐量: 2.41 记录/秒
  数据库已清空

  测试 3: BATCH_SIZE=20, STATION_COUNT=5
    - 测试 GenerateAirQualityData... ✓ (8.400s)
    - 测试 ProcessAirQualitySummary... ✓ (4.301s)
    - 总耗时: 12.702s
    - 吞吐量: 2.38 记录/秒

================================================================================
测试场景: BATCH_SIZE=50, STATION_COUNT=8
================================================================================
  数据库已清空

  测试 1: BATCH_SIZE=50, STATION_COUNT=8
    - 测试 GenerateAirQualityData... ✓ (18.156s)
    - 测试 ProcessAirQualitySummary... ✓ (4.365s)
    - 总耗时: 22.521s
    - 吞吐量: 2.75 记录/秒
  数据库已清空

  测试 2: BATCH_SIZE=50, STATION_COUNT=8
    - 测试 GenerateAirQualityData... ✓ (18.707s)
    - 测试 ProcessAirQualitySummary... ✓ (6.024s)
    - 总耗时: 24.732s
    - 吞吐量: 2.67 记录/秒
  数据库已清空

  测试 3: BATCH_SIZE=50, STATION_COUNT=8
    - 测试 GenerateAirQualityData... ✓ (18.102s)
    - 测试 ProcessAirQualitySummary... ✓ (4.843s)
    - 总耗时: 22.945s
    - 吞吐量: 2.76 记录/秒

================================================================================
测试场景: BATCH_SIZE=100, STATION_COUNT=10
================================================================================
  数据库已清空

  测试 1: BATCH_SIZE=100, STATION_COUNT=10
    - 测试 GenerateAirQualityData... ✓ (35.360s)
    - 测试 ProcessAirQualitySummary... ✓ (6.421s)
    - 总耗时: 41.781s
    - 吞吐量: 2.83 记录/秒
  数据库已清空

  测试 2: BATCH_SIZE=100, STATION_COUNT=10
    - 测试 GenerateAirQualityData... ✓ (37.101s)
    - 测试 ProcessAirQualitySummary... ✓ (5.057s)
    - 总耗时: 42.158s
    - 吞吐量: 2.70 记录/秒
  数据库已清空

  测试 3: BATCH_SIZE=100, STATION_COUNT=10
    - 测试 GenerateAirQualityData... ✓ (34.558s)
    - 测试 ProcessAirQualitySummary... ✓ (4.475s)
    - 总耗时: 39.033s
    - 吞吐量: 2.89 记录/秒

================================================================================
测试场景: BATCH_SIZE=200, STATION_COUNT=15
================================================================================
  数据库已清空

  测试 1: BATCH_SIZE=200, STATION_COUNT=15
    - 测试 GenerateAirQualityData... ✓ (60.732s)
    - 测试 ProcessAirQualitySummary... ✓ (4.382s)
    - 总耗时: 65.115s
    - 吞吐量: 3.29 记录/秒
  数据库已清空

  测试 2: BATCH_SIZE=200, STATION_COUNT=15
    - 测试 GenerateAirQualityData... ✓ (63.667s)
    - 测试 ProcessAirQualitySummary... ✓ (4.243s)
    - 总耗时: 67.910s
    - 吞吐量: 3.14 记录/秒

✓ 结果已保存到: performance_results.csv

================================================================================
性能测试总结报告
================================================================================

配置                        平均总耗时(s)        平均吞吐量                平均CPU%       内存增长(MB)       
----------------------------------------------------------------------------------------------------
BS=20, SC=5               12.879          2.33                 0.1          -1.49          
BS=50, SC=8               23.399          2.73                 0.1          -1.91          
BS=100, SC=10             40.991          2.81                 0.1          -4.10          
BS=200, SC=15             66.512          3.22                 0.1          -4.70          

================================================================================
详细性能指标
================================================================================

配置: BATCH_SIZE=20, STATION_COUNT=5 (3 次测试)
--------------------------------------------------------------------------------
  GenerateAirQualityData:
    - 平均执行时间: 8.584s
    - 峰值内存使用: 0.00 MB
  ProcessAirQualitySummary:
    - 平均执行时间: 4.295s
    - 峰值内存使用: 0.01 MB
  吞吐量: 2.33 记录/秒

配置: BATCH_SIZE=50, STATION_COUNT=8 (3 次测试)
--------------------------------------------------------------------------------
  GenerateAirQualityData:
    - 平均执行时间: 18.322s
    - 峰值内存使用: 0.01 MB
  ProcessAirQualitySummary:
    - 平均执行时间: 5.077s
    - 峰值内存使用: 0.02 MB
  吞吐量: 2.73 记录/秒

配置: BATCH_SIZE=100, STATION_COUNT=10 (3 次测试)
--------------------------------------------------------------------------------
  GenerateAirQualityData:
    - 平均执行时间: 35.673s
    - 峰值内存使用: 0.01 MB
  ProcessAirQualitySummary:
    - 平均执行时间: 5.318s
    - 峰值内存使用: 0.03 MB
  吞吐量: 2.81 记录/秒

配置: BATCH_SIZE=200, STATION_COUNT=15 (2 次测试)
--------------------------------------------------------------------------------
  GenerateAirQualityData:
    - 平均执行时间: 62.200s
    - 峰值内存使用: 0.03 MB
  ProcessAirQualitySummary:
    - 平均执行时间: 4.313s
    - 峰值内存使用: 0.06 MB
  吞吐量: 3.22 记录/秒

================================================================================
可扩展性分析
================================================================================

负载增加对性能的影响:
  20→50 条记录:
    - 负载增加: 150.0%
    - 执行时间增加: 81.7%
    - 扩展效率: 良好
  50→100 条记录:
    - 负载增加: 100.0%
    - 执行时间增加: 75.2%
    - 扩展效率: 良好
  100→200 条记录:
    - 负载增加: 100.0%
    - 执行时间增加: 62.3%
    - 扩展效率: 良好

================================================================================
测试完成时间: 2025-11-19 01:31:40
总测试次数: 11
================================================================================

✓✓✓ 性能测试完成！✓✓✓

生成的文件:
  - performance_results.csv (详细数据)

下一步:
  1. 查看 performance_results.csv 了解详细数据
  2. 可以用 Excel 或 Python 生成图表
  3. 将结果写入报告文档
